# アプリケーション変更履歴 - v2.4

## 2024-06-XX - 追加機能
- 洞察データ収集と分析機能を追加
- Geminiを使用した二層構造特性分析を実装
- 音声メッセージ処理機能を追加

## 実装詳細

### 1. 洞察サービス (`insightsService.js`)
- ユーザー利用統計を収集・保存するモジュールを実装
- テキストリクエストと画像リクエストの追跡機能
- 利用頻度、メッセージ長、利用パターンなどの分析
- 統計レポート生成機能
- データの永続化（15分ごとにファイル保存）

### 2. 二層構造特性分析 (`enhancedCharacteristicsAnalyzer.js`)
- Google Gemini APIを使用した高度な特性分析
- 会話パターン、思考プロセス、社会的相互作用、感情表現などの構造化分析
- OpenAIをフォールバックとして使用（Gemini APIキーが利用できない場合）
- 分析結果のキャッシュ機能（3日間有効）
- 特性に基づいた共感的応答生成機能

### 3. 音声処理 (`audioHandler.js`)
- OpenAI Whisper APIを使用した音声認識機能
- 音声からテキストへの変換（Speech-to-Text）
- テキストから音声への変換（Text-to-Speech）
- ユーザーごとの音声設定管理（声のタイプ、話速など）
- 長文分割機能と音声設定分析機能

## アーキテクチャ変更
- サーバーコードに新機能モジュールを統合
- テキスト/画像/音声処理の各フローに洞察収集を追加
- 既存の特性分析を拡張特性分析に強化
- 各種一時ファイル保存用のディレクトリ構造を追加

## 今後の課題
- 音声応答のLINE Botへの統合
- 洞察データの可視化ダッシュボード
- ユーザー特性に基づいた自動プロンプト調整 